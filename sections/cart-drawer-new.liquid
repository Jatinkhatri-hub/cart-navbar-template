{{ 'cart-drawer-new.css' | asset_url | stylesheet_tag }}
<script src="{{ 'cart-drawer-dd.js' |  asset_url }}" defer></script>

<div class="cart-drawer__wrapper close color-{{ section.settings.color_scheme }}">
  <div class="cart-drawer__box">
    <header class="cart-drawer__header">
      <div class="cart-header__b1">
        <h2>{{ section.settings.cart_title }}</h2>
        <span class="cart-items__count">{{ cart.item_count }}</span>
        <button class="cart-close__btn">{{ 'icon-close-new.svg' | inline_asset_content }}</button>
      </div>
      <div class="cart-header__b2">
        <p>{{ section.settings.user_signup }}
          <a href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}">Learn More</a>.</p>
      </div>
    {% comment %} <div class="cart-header__b3">
                    <p>Add <span>{{ cart.items_subtotal_price |  money_with_currency }}</span> more to get $20 in store credit!</p>
              </div> {% endcomment %}
    </header>
    {% form 'cart'
      , cart
      , class: 'cart-drawer__form' %}
      {% if cart.item_count == 0 %}
        <p class="cart-drawer__empty">Your cart is empty</p>
      {% else %}
        <div class="cart-drawer__items">
          <div class="swiper mySwiper-{{ section.id }}">
            <div class="product-offers__wrapper swiper-wrapper"> 
            {% for block in section.blocks %} 
              <div class="offer__product-card swiper-slide" data-product-id="{{ block.settings.product.variants.first.id }}" data-min-value="{{ block.settings.min_total }}">
                <div class="offer-product__img-wrapper">
                  {% comment %} <img src="{{ block.settings.product.featured_image.first |  image_url: width: block.settings.product.featured_image.first.width }}" class="offer-prodcut__img"> {% endcomment %}
                  {{ block.settings.product.featured_image | image_url: width: 500 | image_tag: sizes: sizes, widths: '200,300,400,500,600,700,800,900,1000,1200,1400,1600,1800,2000,2200,2400,2600,2800,3000,3200', class: "offer-product__img" }}
                </div>
                <div class="offer-product__info">
                  <div>
                    <h2>{{ block.settings.product.title }}</h2>
                    <h3>{{ block.settings.offer_desc }}</h3>
  
                  </div>
                  <a class="claim-offer__btn" data-product-id="{{ block.settings.product.variants.first.id }}">Claim Offer</a>
                </div>
              </div>
            {% endfor %}
            </div>
            
          </div>
          {% for item in cart.items %}
            <div class="line-item" data-line-item-key="{{ item.key }}">
              <div class="line-item__wrapper">
                <div class="line-item__img">
                  <img src="{{ item.image |  image_url: width: item.image.width }}" alt="{{ item.title }}">
                </div>
                <div class="line-item__info">
                  <div class="line-item__header">
                    <h2 class="line-item__title">
                      {{ item.product.title | default: item.title }}
                    </h2>
                    {% for option in item.product.options %}
                      <h4 class="line-item__variant">
                        {{ option }} : {{ item.variant.title }}
                      </h4>

                    {% endfor %}

                    <a href="{{ item.url_to_remove }}" class="line-item__remove">{{ 'icon-dustbin.svg' | inline_asset_content }}</a>
                  </div>
                  <div class="line-item__mid">
                    <div class="line-item__price-wrapper">
                      <span class="line-item__current-price">{{ item.final_line_price | money_with_currency }}</span>
                      <span class="line-item__cap">
                        
                        
                      {% if item.variant.selling_plan_allocations != blank %} 
                        {{ item.selling_plan_allocation.compare_at_price | times: item.quantity | money_with_currency }}   
                      {% else %}
                        {{ item.product.compare_at_price | money_with_currency }} 
                      {% endif %}

                        </span>

                    </div>


                    <div class="line-item__quantity-selector" data-line-item-key="{{ item.key }}">
                      <button class="line-item__quantity-selector-minus">{{ 'icon-minus-new.svg' | inline_asset_content }}</button>
                      <input
                        type="text"
                        readonly
                        value="{{ item.quantity }}">
                      <button class="line-item__quantity-selector-plus">{{ 'icon-plus-new.svg' | inline_asset_content }}</button>
                    </div>
                  </div>
                </div>
              </div>
              {% comment %} <select
                                name="selling-plan"
                                data-line="{{ forloop.index }}"
                                data-quantity="{{ item.quantity }}">
                                <option value="">One-time purchase</option>

                                {% for selling_plan_allocation in item.variant.selling_plan_allocations %}
                                  <option
                                    value="{{ selling_plan_allocation.selling_plan.id }}"
                                    {% if item.selling_plan_allocation.selling_plan.id == selling_plan_allocation.selling_plan.id %}
                                    selected="selected"
                                    {% endif %}>
                                    {{ selling_plan_allocation.selling_plan.name }}
                                  </option>
                                {% endfor %}
                            </select> {% endcomment %}
              <div class="subscription-options">
                <div style="display: flex;">
                  <label>
                    <input
                      type="checkbox"
                      class="subscription-checkbox"
                      data-line="{{ forloop.index }}"
                      {% if item.selling_plan_allocation %}
                      checked
                      {% endif %}>
                    Subscribe and Save
                  </label>
                  <span class="info-circle" tabindex="0">i</span>

                </div>

                <div class="subscription-dropdown" data-line="{{ forloop.index }}"  style="display: none;">
                  <select
                    name="selling-plan"
                    class="selling-plan-selector"
                    data-line="{{ forloop.index }}"
                    data-quantity="{{ item.quantity }}">
                    <option value="">One-time purchase</option>

                    {% for selling_plan_allocation in item.variant.selling_plan_allocations %}
                      <option
                        value="{{ selling_plan_allocation.selling_plan.id }}"
                        {% if item.selling_plan_allocation and item.selling_plan_allocation.selling_plan.id == selling_plan_allocation.selling_plan.id %}
                        selected="selected"
                        {% endif %}>
                        {{ selling_plan_allocation.selling_plan.name }}
                      </option>
                    {% endfor %}
                  </select>
                </div>
              </div>

            </div>
          {% endfor %}
        </div>
        <footer class="cart-drawer__footer">
          <div class="cart-drawer__footer-row">
            <h3>Subtotal</h3>
            <div>
              <span>{{ cart.total_price | money_with_currency }}</span>
              <span style="color: #7e7e7e; text-decoration: line-through">{{ cart.original_total_price |  money_with_currency}}</span>
            </div>
          </div>
          <button
            type="submit"
            name="checkout"
            class="cart-drawer__checkout-btn">{{ 'icon-cart-new.svg' | inline_asset_content }} Proceed to checkout</button>
          <div class="cart-drawer__payment-options">
            <p>Secure checkout with
            </p>
            <div class="cart-drawer__payment-provider-img">
              <img src="{{ section.settings.payment_provider |  image_url: width: section.settings.payment_provider.width }}" class="paymen-img">
            </div>
          </div>
        </footer>
      {% endif %}
    {% endform %}
  </div>
</div>

{% comment %} <script>
  document.addEventListener('DOMContentLoaded', () => {


    // let swiper = new Swiper('.mySwiper-{{ section.id }}', {
    //   slidesPerView: 'auto',
    //   spaceBetween: 10,
      
    // });

    

  });
</script> {% endcomment %}

{% comment %} <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Ensure Swiper initializes after content is loaded
    setTimeout(() => {
      let swiper = new Swiper('.mySwiper-{{ section.id }}', {
        slidesPerView: 'auto',
        spaceBetween: 10,
        centeredSlides: false,
        
      });
    }, 100);  // Delay to ensure the DOM is fully loaded
  });
</script> {% endcomment %}

{% comment %} <script>
      document.addEventListener('DOMContentLoaded', () => {
        document.querySelector('.line-item__remove').addEventListener('click', (e) => {
          e.preventDefault();
        })
      })
</script> {% endcomment %}

{% schema %}
  {
    "name": "Cart Drawer",
    "tag": "section",
    "enabled_on": {
      "groups": ["header"]
    },
    "settings": [
      {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "t:section.all.colors.label",
        "default": "scheme-1"
      }, {
        "type": "inline_richtext",
        "id": "cart_title",
        "label": "Title",
        "default": "Cart Title"
      }, {
        "type": "inline_richtext",
        "id": "user_signup",
        "label": "Membership Upsell",
        "info": "Short description to redirect to membership upsell.",
        "default": "Short Description."
      }, {
        "type": "image_picker",
        "id": "payment_provider",
        "label": "Payment Provider"
      }

    ],
    "blocks": [
      {
        "type": "product_offer",
        "name": "Offer Product",
        "settings": [
          {
            "type": "product",
            "id": "product",
            "label": "Product"
          },
          {
            "type": "text",
            "id": "offer_desc",
            "label": "Offer Description",
            "default": "Subheading With Info"
          },
          {
            "type": "header",
            "content": "Offer Conditions"
          },
          {
            "type": "text",
            "id": "min_total",
            "label": "Minimum Total Required",
            "info": "Please input minimum cart total required to available this offer"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Cart Drawer"
      }
    ]
  }
{% endschema %}